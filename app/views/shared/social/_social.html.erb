<%= render "/shared/social/fbconnect", { :page => page } %>
<%= render "/shared/social/winconnect", { :page => page } %>
<div id="social">
  <div class="container">
    <span class="title"><%= t('sessions.new.social') %></span>
    <br /><br class="clearer"/>
    <div>
      <fb:login-button id="fb_login" perms="user_birthday, email"></fb:login-button>
    </div>
    <div>
      <wl:signin id="signInControl"
        signedintext="You are logged in"
        signedouttext="You are logged out"
        onsignin="onWinConnectLogin"></wl:signin>
    </div>
  </div>
</div>

<% javascript_tag do %>
function onWinConnectLogin(p_event) {
  alert('win connect login');
  //debugAuth();
  if (Microsoft.Live.App.get_auth().get_state() == Microsoft.Live.AuthState.failed) {
    alert('win login fail');
  }
  else if (Microsoft.Live.App.get_auth().get_state() == Microsoft.Live.AuthState.authenticated) {
    alert('win login success');
    dataContext = Microsoft.Live.App.get_dataContext();
    dataContext.loadAll(Microsoft.Live.DataType.profile, function(p_event) {
      if (p_event.get_resultCode() !== Microsoft.Live.AsyncResultCode.success) {
        alert("Profiles not loaded.");
      }
      else {
        console.dir(p_event);
        alert(p_event.first_name);
      } 
    });
  }  
}
<% end %>

<% # signedintext="<%= t('win_connect.login.in') % >" %>
<% # signedouttext="<%= t('win_connect.login.out') % >" %>
