<% 
  src = is_staging? ? "http://staging.login.hoodiny.com:8081/" : "http://login.cyloop.com:8081/"
  src += "winconnect_button/coke?host=#{current_site_url}"
%>
<%= content_tag(:iframe, nil, :frameborder=>"0", :scrolling=>"no", :width=>"75", :height=>"30", :src=>src) %>

<% # I wish content_for :head worked here, but it doesn't (in the messenger tab). %>
<%- javascript_tag do -%>
  function onWinConnectLoginSuccess() {
    if (window['current_site_mode'] && window['current_site_mode'].toLowerCase() == "msn") {
      alert("WinConnect login on MSN tab");
      $.ajax({
        url: '<%= status_path(:format => :json) %>',
        success: function(response) { 
          alert('logged_in? ' + response.logged_in);
          if (response.logged_in) {
            window.location.reload(true);
          } else {
            // Scott, do your thang here.
            alert("The Scott Spot");
          }
        },
        error: function(error) { alert('error getting session status.'); }
      });
    } else {
      document.location = current_url_site + '/login?' + document.location.search
        + '&page=<%= page if defined? page %>';
    }
  };
<%- end -%>

